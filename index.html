<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ðŸŒ² Space Blaster VR</title>
  <meta name="description" content="A simple VR game - destroy asteroids by looking at them!">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
  <style>
    #score-display {
      position: fixed;
      top: 20px;
      left: 20px;
      color: #0f0;
      font-family: 'Courier New', monospace;
      font-size: 24px;
      z-index: 999;
      text-shadow: 0 0 10px #0f0;
    }
    #instructions {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-family: Arial, sans-serif;
      font-size: 18px;
      z-index: 999;
      text-align: center;
      background: rgba(0,0,0,0.5);
      padding: 10px 20px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div id="score-display">SCORE: 0</div>
  <div id="instructions">ðŸ‘€ Look at asteroids to destroy them! Enter VR for full experience.</div>

  <a-scene>
    <!-- Environment: Space -->
    <a-sky color="#000011"></a-sky>
    
    <!-- Stars -->
    <a-entity id="stars"></a-entity>

    <!-- Player camera with cursor (gaze-based interaction) -->
    <a-entity id="rig" position="0 1.6 0">
      <a-camera>
        <a-cursor 
          color="#00ff00" 
          fuse="true" 
          fuse-timeout="500"
          raycaster="objects: .shootable"
          animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
          animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.5 0.5 0.5; dur: 500"
          animation__mouseleave="property: scale; startEvents: mouseleave; to: 1 1 1; dur: 150">
        </a-cursor>
        <!-- Crosshair ring -->
        <a-ring color="#00ff00" radius-inner="0.02" radius-outer="0.03" position="0 0 -1" opacity="0.5"></a-ring>
      </a-camera>
    </a-entity>

    <!-- Asteroid container -->
    <a-entity id="asteroids"></a-entity>

    <!-- Ambient light -->
    <a-light type="ambient" color="#222"></a-light>
    <a-light type="directional" color="#fff" intensity="0.5" position="-1 2 1"></a-light>

    <!-- Score display in VR -->
    <a-text id="vr-score" value="SCORE: 0" position="0 2.5 -3" align="center" color="#0f0" width="6"></a-text>

    <!-- Explosion particle template -->
    <a-entity id="explosion-template" visible="false">
      <a-sphere radius="0.1" color="#ff6600" opacity="0.8"></a-sphere>
    </a-entity>
  </a-scene>

  <script>
    // Game state
    let score = 0;
    let level = 1;
    let asteroidsDestroyed = 0;
    const asteroidsPerLevel = 5;

    // Update score display
    function updateScore() {
      document.getElementById('score-display').textContent = `SCORE: ${score} | LEVEL: ${level}`;
      document.getElementById('vr-score').setAttribute('value', `SCORE: ${score}  LEVEL: ${level}`);
    }

    // Create stars
    function createStars() {
      const starsEl = document.getElementById('stars');
      for (let i = 0; i < 200; i++) {
        const star = document.createElement('a-sphere');
        star.setAttribute('radius', Math.random() * 0.05 + 0.01);
        star.setAttribute('color', '#ffffff');
        star.setAttribute('position', {
          x: (Math.random() - 0.5) * 100,
          y: (Math.random() - 0.5) * 100,
          z: (Math.random() - 0.5) * 100
        });
        starsEl.appendChild(star);
      }
    }

    // Create explosion effect
    function createExplosion(position) {
      const scene = document.querySelector('a-scene');
      const particleCount = 8;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('a-sphere');
        particle.setAttribute('radius', 0.1);
        particle.setAttribute('color', Math.random() > 0.5 ? '#ff6600' : '#ffff00');
        particle.setAttribute('position', position);
        particle.setAttribute('opacity', 0.9);
        
        // Random direction
        const angle = (i / particleCount) * Math.PI * 2;
        const speed = 2 + Math.random() * 2;
        const targetPos = {
          x: position.x + Math.cos(angle) * speed,
          y: position.y + (Math.random() - 0.5) * speed,
          z: position.z + Math.sin(angle) * speed
        };
        
        particle.setAttribute('animation', {
          property: 'position',
          to: `${targetPos.x} ${targetPos.y} ${targetPos.z}`,
          dur: 500,
          easing: 'easeOutQuad'
        });
        particle.setAttribute('animation__fade', {
          property: 'opacity',
          to: 0,
          dur: 500
        });
        particle.setAttribute('animation__shrink', {
          property: 'scale',
          to: '0 0 0',
          dur: 500
        });
        
        scene.appendChild(particle);
        
        // Remove particle after animation
        setTimeout(() => particle.remove(), 600);
      }
    }

    // Create asteroid
    function createAsteroid() {
      const asteroidsEl = document.getElementById('asteroids');
      const asteroid = document.createElement('a-dodecahedron');
      
      // Random position around player
      const angle = Math.random() * Math.PI * 2;
      const distance = 5 + Math.random() * 10;
      const height = Math.random() * 4 - 1;
      
      asteroid.setAttribute('position', {
        x: Math.cos(angle) * distance,
        y: height,
        z: Math.sin(angle) * distance
      });
      
      // Size based on level (smaller = harder)
      const size = Math.max(0.3, 1 - level * 0.05) + Math.random() * 0.5;
      asteroid.setAttribute('radius', size);
      
      // Brownish-gray color
      const shade = Math.floor(Math.random() * 50 + 60);
      asteroid.setAttribute('color', `rgb(${shade + 20}, ${shade}, ${shade - 10})`);
      
      asteroid.classList.add('shootable');
      
      // Rotate animation
      asteroid.setAttribute('animation', {
        property: 'rotation',
        to: `${Math.random() * 360} ${Math.random() * 360} ${Math.random() * 360}`,
        loop: true,
        dur: 3000 + Math.random() * 4000,
        easing: 'linear'
      });
      
      // Slow movement
      const moveSpeed = 10000 + Math.random() * 10000;
      const newAngle = angle + (Math.random() - 0.5);
      const newDistance = 5 + Math.random() * 10;
      asteroid.setAttribute('animation__move', {
        property: 'position',
        to: `${Math.cos(newAngle) * newDistance} ${Math.random() * 4 - 1} ${Math.sin(newAngle) * newDistance}`,
        dur: moveSpeed,
        loop: true,
        dir: 'alternate',
        easing: 'easeInOutSine'
      });
      
      // Click handler (gaze-triggered)
      asteroid.addEventListener('click', function() {
        const pos = this.getAttribute('position');
        createExplosion({x: pos.x, y: pos.y, z: pos.z});
        
        // Score based on size (smaller = more points)
        const asteroidSize = this.getAttribute('radius');
        const points = Math.floor((2 - asteroidSize) * 100);
        score += points;
        asteroidsDestroyed++;
        
        // Level up
        if (asteroidsDestroyed >= asteroidsPerLevel * level) {
          level++;
          // Spawn more asteroids
          for (let i = 0; i < 3; i++) {
            setTimeout(() => createAsteroid(), i * 500);
          }
        }
        
        updateScore();
        this.remove();
        
        // Spawn new asteroid
        setTimeout(createAsteroid, 1000 + Math.random() * 2000);
      });
      
      // Visual feedback on hover
      asteroid.addEventListener('mouseenter', function() {
        this.setAttribute('color', '#ff4444');
      });
      asteroid.addEventListener('mouseleave', function() {
        const shade = Math.floor(Math.random() * 50 + 60);
        this.setAttribute('color', `rgb(${shade + 20}, ${shade}, ${shade - 10})`);
      });
      
      asteroidsEl.appendChild(asteroid);
    }

    // Initialize game
    document.querySelector('a-scene').addEventListener('loaded', function() {
      createStars();
      
      // Spawn initial asteroids
      for (let i = 0; i < 8; i++) {
        setTimeout(() => createAsteroid(), i * 300);
      }
      
      updateScore();
    });
  </script>
</body>
</html>
